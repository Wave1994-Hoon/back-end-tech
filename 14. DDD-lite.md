# DDD Lite
## 출처
https://www.youtube.com/watch?v=TdyOH1xZpT8&ab_channel=NHNCloud

<br>

## 1, 프로젝트 위기 사이클
빠르고 간단하게 구축 --> 새로운 요구 사항 --> 복잡성 증가 --> 가파른 비용 증가, 급격한 생산성 감소 --> 위기 --> 차세대 개편 + 레거시 의존

<br>

## 2. DDD 의 전략적 패턴
해결 공간을 뽑아내는 패턴을 의미한다. (큰 그림을 잘 그리는 것)

- 일반: 계정, 메일과 같이 대부분의 어플리케이션에서 사용되는 (서브)도메인
- 지원: 제품 조회, 배송 서비스와 같은 지원(서브)도메인
- 핵심: 결제와 같이 도메인 영역 중 해결해야할 도메인

<img width="800" src="https://user-images.githubusercontent.com/60383031/151820191-efc11dc6-bcfb-441b-9985-d66ac32aac8b.png">

위 그림과 같이 도메인을 구분(정의)하는 것을 전략적 패턴이라고 한다.

<br>

## 3. DDD 의 전술적 패턴
국지적인 바운디드 컨텍스트 내에서 사용하는 전술을 정의하는 것을 의미

<img width="800" src="https://user-images.githubusercontent.com/60383031/151820317-d2fa985b-a226-4047-a8b5-61348236f4fa.png">


전술적 패턴들의 모음

<img width="800" src="https://user-images.githubusercontent.com/60383031/151820949-d24ae6e1-5f57-4ffb-86ce-267bfc5bb777.png">


DDD Lite 의 엄밀한 정의

<img width="800" src="https://user-images.githubusercontent.com/60383031/151821304-5ca9aeaa-8c9d-441c-9fd6-0ced4348355d.png">

본 세션에서는 두 용어를 혼용해서 사용하겠다고 함

<br>

## 4. 위키 서비스 전략적 패턴 예제 
도메인 정의 

<img width="800" src="https://user-images.githubusercontent.com/60383031/151821749-09f1b6ab-00b1-4bb1-8440-804825b79696.png">

전략적 패턴 

<img width="800" src="https://user-images.githubusercontent.com/60383031/151822016-755e2ae7-0a82-4262-9733-555e83122707.png">

- 핵심: 위키 서비스
- 서브: 프로젝트 서비스
- 일반: 계정, 검색 서비스

도메인 관계도

<img width="800" src="https://user-images.githubusercontent.com/60383031/151822358-8b7bbaf0-f5cf-419d-b739-825fc1266b06.png">

프로젝트와 위키는 1:1 관계이다.

<br>

## 5. 위키 서비스 전술적 패턴 예제
실제 엔티티를 모델링 할때는 행위(행동)가 매우 중요하다. !!!

속성은 그 다음이다. 행위가 명확하게 도메인을 표현할 수 있어야 한다. 

관계도 꼭 필요한 것만 단방향으로 순환 참조가 되지 않게 도메인을 기반으로 하는 것이 중요하다.

<img width="800" src="https://user-images.githubusercontent.com/60383031/151823593-3ceffabf-57c3-4adb-9e25-4a41d1d61c76.png">


Value Object 예시

<img width="800" src="https://user-images.githubusercontent.com/60383031/151824226-99cd523f-4dc4-4304-b936-1e4922e4f55a.png">

공통적인 값들을 Value Object 로 묶을 수 있다.

<br>

## 6. Aggregate (집합체)  
Aggregate 는 불변식을 의미한다.

불변식이란 도메인 모델의 일관성을 유지해주는 규칙이다. 즉 데이터 변경의 단위라고 보면 된다.

데이터 변경의 단위를 DB 관점으로 보면 Transaction의 단위로 볼 수 있다. 분산환경 관점으로 보면 Lock 의 단위로 볼 수 있다.

<br>

Aggregate 관계도

<img width="800" src="https://user-images.githubusercontent.com/60383031/151826544-eac1ae52-e7f0-4bfa-9c42-5c4b9d4d39eb.png">

Page 는 PageUser 와 PageFile 이 함께 할 것 같아 집합화 시켰다고 한다.

하지만 새로운 요구 사항으로 PageFile 을 하나만 받거나 업로드하는 것이 추가되어서 Aggregate 를 분리했다고 한다. (상황 이해는 잘 안감) 

AggregateRoot 는 Gateway 라고 보면 된다.

<br>

위 예제에서 PageUser 로 다이렉트로 접근할 수 없다. 접근하기 위해서는 Page 를 통해서만 접근이 가능하다.

그리고 또 하나 지켜야할 규칙은 Aggregate 당 Repository 는 하나만 있어야한다.

위 예제애서는 3개의 Repository 가 필요하다.

<br>

Page Aggregate JPA 예제

<img width="800" src="https://user-images.githubusercontent.com/60383031/151827122-16a1bb4a-0bf9-459c-971d-88003ed25cc4.png">




